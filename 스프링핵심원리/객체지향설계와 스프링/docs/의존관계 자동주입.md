## 다양한 의존관계 주입 방법

의존관계 주입 4가지 방법

- 생성자 주입
- 수정자 주입( setter 주입)
- 필드 주입
- 일반 메서드 주입

### 생성자 주입

- 이름 그대로 생성자를 통해서 의존 관계를 주입 받는 방법
- 지금까지 학습했던 방법
- 특징
  - 생성자 호출 시점에 딱 1번만 호출되는 것이 보장된다.
  - **불변, 필수** 의존관계에 사용
  - 생성자가 딱 1개일 때는 `@Autowired` 를 **생략해도 자동 주입**된다.

```java
  	@Autowired   <- 생성자 하나일 때는 사실 생략해도 된다.
public OrderServiceImpl(MemberRepository memberRepository, DiscountPolicy discountPolicy) {
  this.memberRepository = memberRepository;
  this.discountPolicy = discountPolicy;
}
```

### 수정자 주입(setter 주입)

- setter라 불리는 필드의 값을 변경하는 수정자 메서드를 통해서 의존관계를 주입하는 방법이다.
- 특징
  - **선택, 변경** 가능성이 있는 의존 관계에 사용
  - 자바빈 프로터피 규약의 수정자 메서드 방식을 사용하는 방법
- `@Autowired` 는 주입할 대상이 없으면 오류가 발생. 주입 대상이 없어도 동작하게 하려면

  `@Autowired(required=false)` 로 지정한다.


```java
		@Autowired
		public void setMemberRepository(MemberRepository memberRepository) {
        this.memberRepository = memberRepository;
    }
    
    @Autowired
    public void setDiscountPolicy(DiscountPolicy discountPolicy) {
        this.discountPolicy = discountPolicy;
    }
```

### 필드 주입

- 필드에 주입하는 방식
- 특징
  - 코드가 간결하지만 외부에서 변경이 불가능해서 테스트하기 힘들다
  - 쓰지말자

### 일반 메서드 주입

- 일반 메서드를 통해서 주입 받을 수 있다.
- 특징
  - 한번에 여러 필드를 주입 받을 수 있다.
  - 일반적으로 잘 사용하지 않는다.


```java
  @Component
  public class OrderServiceImpl implements OrderService {

    private final MemberRepository memberRepository;
    private final DiscountPolicy discountPolicy;

    @Autowired
    public init(MemberRepository memberRepository, DiscountPolicy discountPolicy) {
        this.memberRepository = memberRepository;
        this.discountPolicy = discountPolicy;
    }
}
```

**의존관계 자동주입은 스프링 컨테이너가 관리하는 스프링 빈이어야 동작**한다. 스프링 빈이 아닌 Member 같은 클래스에서  @Autowired를 사용해도 동작 X

## 옵션 처리

주입할 스프링 빈이 없어도 동작해야 할 때 사용.

`@Autowired`만 사용하면 reqired 옵션의 기본 값이 true로 되어 있어서 자동 주입 대상이 없으면 오류가 발생한다.

자동 주입 대상을 옵션으로 처리하는 방법은 다음과 같다.

- `@Autowired(required=false)` : 자동 주입할 대상이 없으면 수정자 메서드 자체가 호출 안 됨
- `@Nullable` : 자동 주입할 대상이 없으면 null이 입력
- `Optional<>` 자동 주입할 대상이 없으면 Optional.empty가 입력

```java
  static class TestBean {

      @Autowired(required = false)
      public void setNoBean1(Member noMember1) {
          System.out.println("noMember1 = " + noMember1);
      }

      @Autowired
      public void setNoBean2(@Nullable Member noMember2) {
          System.out.println("noMember2 = " + noMember2);
      }

      @Autowired
      public void setNoBean3(Optional<Member> noBean3) {
          System.out.println("noBean3 = " + noBean3);
      }
  }
```